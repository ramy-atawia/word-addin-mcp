# Development Environment Configuration

## Overview
This document outlines the complete configuration required for the development environment deployment of the Word Add-in MCP application.

## Azure Resources

### App Service Plan
- **Name**: `novitai-word-mcp-dev-plan`
- **Resource Group**: `novitai-word-mcp-rg`
- **SKU**: `B1` (Basic)
- **Tier**: `Basic`
- **Max Workers**: `3`
- **Number of Sites**: `2`

### Container Registry
- **Name**: `novitaiwordmcp`
- **Login Server**: `novitaiwordmcp.azurecr.io`
- **Username**: `novitaiwordmcp`
- **Password**: `[Generated by Azure]`

## Backend Configuration

### App Service Settings
The development backend (`novitai-word-mcp-backend-dev`) requires the following environment variables:

#### Core Application Settings
```bash
ENVIRONMENT=development
LOG_LEVEL=DEBUG
DEBUG=false
PORT=9000
SECRET_KEY=K9MHoSnUTr7ia6L9jaXQD8MZF4Eo/bxciBHmlTQQySg=
```

#### Docker Configuration
```bash
DOCKER_REGISTRY_SERVER_URL=https://novitaiwordmcp.azurecr.io
DOCKER_REGISTRY_SERVER_USERNAME=novitaiwordmcp
DOCKER_REGISTRY_SERVER_PASSWORD=[ACR_PASSWORD]
DOCKER_ENABLE_CI=true
SCM_DO_BUILD_DURING_DEPLOYMENT=1
```

#### CORS and Security
```bash
ALLOWED_ORIGINS=["https://novitai-word-mcp-frontend-dev.azurewebsites.net"]
ALLOWED_HOSTS=["*"]
```

#### Azure OpenAI Configuration
```bash
AZURE_OPENAI_API_KEY=[YOUR_AZURE_OPENAI_API_KEY]
AZURE_OPENAI_ENDPOINT=[YOUR_AZURE_OPENAI_ENDPOINT]
AZURE_OPENAI_DEPLOYMENT=gpt-4o-mini
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4o-mini
AZURE_OPENAI_API_VERSION=2024-02-15-preview
```

#### Auth0 Configuration
```bash
AUTH0_DOMAIN=dev-bktskx5kbc655wcl.us.auth0.com
AUTH0_AUDIENCE=INws849yDXaC6MZVXnLhMJi6CZC4nx6U
```

#### External API Keys
```bash
GOOGLE_API_KEY=[YOUR_GOOGLE_API_KEY]
GOOGLE_CSE_ID=[YOUR_GOOGLE_CSE_ID]
PATENTSVIEW_API_KEY=[YOUR_PATENTSVIEW_API_KEY]
```

#### File Processing
```bash
MAX_FILE_SIZE=10485760
WEBSITE_HTTPLOGGING_RETENTION_DAYS=3
WEBSITES_ENABLE_APP_SERVICE_STORAGE=false
```

### Container Configuration
- **Image**: `novitaiwordmcp.azurecr.io/backend:latest`
- **Platform**: `linux/amd64`
- **Target**: `production`

## Frontend Configuration

### App Service Settings
The development frontend (`novitai-word-mcp-frontend-dev`) requires the following environment variables:

#### React Environment Variables
```bash
REACT_APP_API_BASE_URL=https://novitai-word-mcp-backend-dev.azurewebsites.net
REACT_APP_BACKEND_URL=https://novitai-word-mcp-backend-dev.azurewebsites.net
REACT_APP_FRONTEND_URL=https://novitai-word-mcp-frontend-dev.azurewebsites.net
REACT_APP_AUTH0_DOMAIN=dev-bktskx5kbc655wcl.us.auth0.com
REACT_APP_AUTH0_CLIENT_ID=INws849yDXaC6MZVXnLhMJi6CZC4nx6U
REACT_APP_AUTH0_AUDIENCE=INws849yDXaC6MZVXnLhMJi6CZC4nx6U
```

#### Build Configuration
```bash
NODE_ENV=production
DOCKER_ENABLE_CI=true
```

### Container Configuration
- **Image**: `novitaiwordmcp.azurecr.io/frontend:dev`
- **Platform**: `linux/amd64`
- **Build Args**: All `REACT_APP_*` variables must be passed as build arguments

## GitHub Actions Workflow Requirements

### Secrets Required
The following secrets must be configured in the GitHub repository:

#### Azure Service Principal
```bash
AZURE_CLIENT_ID=[Service Principal Client ID]
AZURE_CLIENT_SECRET=[Service Principal Secret]
AZURE_TENANT_ID=[Azure Tenant ID]
AZURE_SUBSCRIPTION_ID=[Azure Subscription ID]
```

#### Container Registry
```bash
ACR_USERNAME=novitaiwordmcp
ACR_PASSWORD=[ACR Admin Password]
```

### Environment Variables
The following environment variables are used in the workflow:

#### Development Environment
```bash
ACR_NAME=novitaiwordmcp
ACR_LOGIN_SERVER=novitaiwordmcp.azurecr.io
BACKEND_APP_NAME=novitai-word-mcp-backend-dev
FRONTEND_APP_NAME=novitai-word-mcp-frontend-dev
RESOURCE_GROUP=novitai-word-mcp-rg
```

## Deployment Process

### Automatic Deployment
- **Trigger**: Push to `dev` branch
- **Workflow**: `.github/workflows/deploy.yml`
- **Target**: Development environment

### Manual Deployment
```bash
# Build and push backend
docker build --platform linux/amd64 -t novitaiwordmcp.azurecr.io/backend:dev --target production ./backend
docker push novitaiwordmcp.azurecr.io/backend:dev

# Build and push frontend
docker build --platform linux/amd64 -t novitaiwordmcp.azurecr.io/frontend:dev \
  --build-arg REACT_APP_API_BASE_URL=https://novitai-word-mcp-backend-dev.azurewebsites.net \
  --build-arg REACT_APP_AUTH0_DOMAIN=dev-bktskx5kbc655wcl.us.auth0.com \
  --build-arg REACT_APP_AUTH0_CLIENT_ID=INws849yDXaC6MZVXnLhMJi6CZC4nx6U \
  --build-arg REACT_APP_AUTH0_AUDIENCE=INws849yDXaC6MZVXnLhMJi6CZC4nx6U \
  ./frontend
docker push novitaiwordmcp.azurecr.io/frontend:dev
```

## Troubleshooting

### Common Issues
1. **ACR Authentication**: Ensure `DOCKER_REGISTRY_SERVER_PASSWORD` is set
2. **Environment Variables**: Verify all required variables are present
3. **Image Pull**: Check if the image exists in ACR
4. **CORS Issues**: Verify `ALLOWED_ORIGINS` format is JSON array
5. **Build Failures**: Ensure all build arguments are passed correctly

### Health Checks
- **Backend Health**: `https://novitai-word-mcp-backend-dev.azurewebsites.net/health`
- **Frontend**: `https://novitai-word-mcp-frontend-dev.azurewebsites.net`
- **Debug Config**: `https://novitai-word-mcp-backend-dev.azurewebsites.net/debug/config`

## Security Notes
- All API keys and secrets should be stored in Azure Key Vault or GitHub Secrets
- Never commit sensitive information to the repository
- Use different Auth0 applications for dev and prod environments
- Regularly rotate API keys and secrets
